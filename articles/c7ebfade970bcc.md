---
title: "useRefã‚’ä½¿ã£ãŸå€¤ç®¡ç†ã‚¬ã‚¤ãƒ‰"
emoji: "ğŸ‡"
type: "tech"
topics: ["react"]
published: true
---

## æ¦‚è¦

useRefã¯DOMã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã¾ã™ãŒã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã«å€¤ã‚’ä¿æŒã™ã‚‹ãŸã‚ã«ã‚‚ä½¿ãˆã¾ã™ã€‚
ã“ã®è¨˜äº‹ã§ã¯ useState ã¨ useRef ã®é•ã„ã‚’è¦‹ãªãŒã‚‰ã€ã©ã®ã‚ˆã†ãªãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã§ useRef ãŒæœ‰åŠ¹ã‹ã‚’ã‚µãƒ³ãƒ—ãƒ«ã‚’è¦‹ãªãŒã‚‰è§£èª¬ã—ã¾ã™ã€‚

> ã—ã‹ã—ãªãŒã‚‰ useRef() ã¯ ref å±æ€§ã§ä½¿ã†ã ã‘ã§ã¯ãªãã€ã‚ˆã‚Šä¾¿åˆ©ã«ä½¿ãˆã¾ã™ã€‚ã“ã‚Œã¯ã‚¯ãƒ©ã‚¹ã§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å¤‰æ•°ã‚’ä½¿ã†ã®ã¨åŒæ§˜ã«ã—ã¦ã€ã‚ã‚‰ã‚†ã‚‹æ›¸ãæ›ãˆå¯èƒ½ãªå€¤ã‚’ä¿æŒã—ã¦ãŠãã®ã«ä¾¿åˆ©ã§ã™ã€‚

https://ja.reactjs.org/docs/hooks-reference.html#useref

## ã¯ã˜ã‚ã«

DOMã‚„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å‚ç…§ã‚’å¾—ã‚‹ä»¥å¤–ã« useRef ã‚’ä½¿ç”¨ã™ã‚‹æ©Ÿä¼šã¯ãã“ã¾ã§å¤šãã‚ã‚Šã¾ã›ã‚“ã€‚å¤§æŠµã®å ´åˆ useState ã‚„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã‚ˆã‚‹çŠ¶æ…‹ç®¡ç†ã§äº‹è¶³ã‚Šã‚‹ã‹ã‚‰ã§ã™ã€‚
ã§ã™ãŒç‰¹å®šã®ã‚±ãƒ¼ã‚¹ã«ãŠã„ã¦ ref ã‚’ä½¿ç”¨ã™ã‚‹ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«å„ªã‚Œã€ã‚·ãƒ³ãƒ—ãƒ«ãªå®Ÿè£…ã«ã§ãã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚useRefãŒæœ‰åŠ¹ãªã‚±ãƒ¼ã‚¹ã‚’çŸ¥ã‚‹ãŸã‚ã«ã¾ãšã¯ useState ã¨ã®é•ã„ã‚’ç¢ºèªã—ã¾ã™ã€‚

## useStateã¨useRefã®é•ã„

useState ã¨æ¯”è¼ƒã—ãŸã¨ã useRef ã®é‡è¦ãªç‰¹å¾´ã¯3ã¤ã§ã™ã€‚

1. æ›´æ–°ã«ã‚ˆã‚‹å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒç™ºç”Ÿã—ãªã„
2. å€¤ãŒåŒæœŸçš„ã«æ›´æ–°ã•ã‚Œã‚‹
3. è¿”å´ã•ã‚Œã‚‹Refã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯åŒä¸€ã§ã‚ã‚‹

### 1. æ›´æ–°ã«ã‚ˆã‚‹å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒç™ºç”Ÿã—ãªã„

useState ã¯ setState ã‚’å®Ÿè¡Œã—ãŸå¾Œã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¾ã™ãŒ useRef ã¯æ›´æ–°ã—ã¦ã‚‚å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
DOMã®æ›´æ–°ãŒç™ºç”Ÿã—ãªã„åˆ†ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«ã¯è‰¯ã„ã§ã™ã€‚å½“ç„¶ã§ã™ãŒUIä¸Šã§ä½¿ç”¨ã™ã‚‹ã¨ ã€Œæ›´æ–°ã—ãŸã®ã«ç”»é¢ã«åæ˜ ã•ã‚Œãªã„ï¼ã€ ãªã‚“ã¦ã“ã¨ã«ãªã‚‹ã®ã§ **æç”»ã«ä½¿ç”¨ã—ãªã„å€¤** ã‚„ **ä»–ã®å‡¦ç†ã§ä½¿ç”¨ã™ã‚‹ä¸€æ™‚ãƒ‡ãƒ¼ã‚¿** ã®ç®¡ç†ã«å‘ã„ã¦ã„ã¾ã™ã€‚

### 2. å€¤ãŒåŒæœŸçš„ã«æ›´æ–°ã•ã‚Œã‚‹

ã€Œå€¤ãŒåŒæœŸçš„ã«æ›´æ–°ã•ã‚Œã‚‹...ã€ãªã«ã‚’å½“ç„¶ã®ã“ã¨ã‚’è¨€ã£ã¦ã‚‹ã‚“ã ã¨æ€ã†ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
ã—ã‹ã— useState ã¯ãã†ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
ä¾‹ãˆã°ã€ä¸€åº¦ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã¿ãŸã“ã¨ãŒã‚ã‚‹ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ï¼Ÿ

```tsx:Counter.tsx
const Counter = () => {
  const [count, setCount] = useState(0);
  
  return (
    <button
      onClick={() => {
        console.log(count);
        setCount(1);
        console.log(count);
      }}
    >
      ã‚«ã‚¦ãƒ³ãƒˆ1
    </button>
  );
};
```

ã“ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸçµæœã¨ã—ã¦ã¯ setCount ã‚’å‘¼ã³å‡ºã—ãŸã«ã‚‚é–¢ã‚ã‚‰ãš count ã¯ä»¥å‰ã®å€¤ã‚’ä¿ã£ã¦ã„ã¾ã™ã€‚

![Result](https://storage.googleapis.com/zenn-user-upload/a4805c1b9ba3-20211130.png)

ã“ã‚Œã¯ useState ãŒåŒä¸€ã® `render` å†…ã§åŒã˜å€¤ã‚’ä¿æŒã—ç¶šã‘ã‚‹ãŸã‚ã§ã™ã€‚
Reactã¯ä¸»ã«ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ãŸã‚ã«åŒä¸€ã®ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ãŒå…¨ã¦çµ‚äº†ã—ãŸå¾Œã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä¸€åº¦ã«å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¾ã™ã€‚
ãã—ã¦æ–°ã—ããƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚ŒãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§åˆã‚ã¦æ›´æ–°ã•ã‚ŒãŸ state ã‚’å‚ç…§ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ã“ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é–“ã«ãŠã‘ã‚‹çŠ¶æ…‹ã®è©³ã—ã„ä»•çµ„ã¿ã¯ä»¥ä¸‹ã®è¨˜äº‹ãŒå‚è€ƒã«ãªã‚Šã¾ã™ã€‚

https://overreacted.io/ja/a-complete-guide-to-useeffect/

ãã‚Œã§ã¯å…ˆç¨‹ã®ã‚³ãƒ¼ãƒ‰ã‚’ useRef ã«æ›¸ãæ›ãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```tsx:Counter.tsx
const Counter = () => {
  const count = useRef(0);

  return (
    <button
      onClick={() => {
        console.log(count.current);
        count.current = 1;
        console.log(count.current);
      }}
    >
      ã‚«ã‚¦ãƒ³ãƒˆ1
    </button>
  );
};
```

![Result2](https://storage.googleapis.com/zenn-user-upload/0fb3d19a31aa-20211130.png)

å€¤ãŒåŒæœŸçš„ã«æ›´æ–°ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚
useState ã«ã‚ˆã‚‹çŠ¶æ…‹ç®¡ç†ã§ã¯å€¤ã‚’æ›´æ–°ã—ã¦ã‚‚æ¬¡ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã¾ã§æœ€æ–°ã®çŠ¶æ…‹ã‚’å‚ç…§ã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚ã—ã‹ã— useRef ãªã‚‰ã°å¸¸ã«æœ€æ–°ã®å€¤ã‚’å‚ç…§ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### 3. è¿”å´ã•ã‚Œã‚‹Refã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯åŒä¸€ã§ã‚ã‚‹

useState ã¯åˆæœŸå€¤ã«æ¸¡ã—ãŸå€¤ã¾ãŸã¯ setState ã§æ›´æ–°ã—ãŸçŠ¶æ…‹ãŒãã®ã¾ã¾è¿”å´ã•ã‚Œã¾ã™ãŒ useRef ã¯Refã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒè¿”å´ã•ã‚Œã¾ã™ã€‚
useRef ã§è¿”å´ã•ã‚Œã‚‹Refã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯å‘¼ã³å‡ºã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå­˜åœ¨ã™ã‚‹é™ã‚ŠåŒä¸€ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚
ã“ã‚Œã¯ useCallback, useMemo, useEffect ãªã©ä¾å­˜é–¢ä¿‚ã‚’æŒã¤Hooksã‚’ä½¿ç”¨ã™ã‚‹éš›ã«ä¾¿åˆ©ã§ã™ã€‚
ä¸Šè¨˜ã®ã‚ˆã†ãªä¾å­˜é–¢ä¿‚ã‚’æŒã¤Hooksã¯ `===` ã§å‰å›ã®å€¤ã¨æ–°ã—ã„å€¤ãŒåŒä¸€ã‹ã©ã†ã‹åˆ¤å®šã—ã¾ã™ã€‚

ãã®ãŸã‚ useRef ã§è¿”å´ã•ã‚Œã‚‹Refã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ä¾å­˜é–¢ä¿‚ã«å«ã‚ã¦ã‚‚ä¾å­˜é–¢ä¿‚ã«å½±éŸ¿ã‚’èµ·ã“ã•ãšã€`eslint` ã® `react-hooks/exhaustive-deps` ãƒ«ãƒ¼ãƒ«ã‚’æœ‰åŠ¹ã«ã—ã¦ã„ã¦ã‚‚Refã¯ä¾å­˜é–¢ä¿‚ã«å«ã‚ã‚‹ã‚ˆã†ã«å‹§ã‚ã‚‰ã‚Œã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã›ã‚“ã€‚

## useRefä½¿ç”¨ä¾‹

useState ã¨ useRef ã®é•ã„ã‚’è¸ã¾ãˆãŸä¸Šã§ã€useRefã®ä½¿ç”¨ä¾‹ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚

### åŸºæœ¬çš„ãªä½¿ç”¨æ–¹æ³•

**ã€Œæ›´æ–°ã«ã‚ˆã‚‹å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒç™ºç”Ÿã—ãªã„ã€** ã¨ **ã€Œå€¤ãŒåŒæœŸçš„ã«æ›´æ–°ã•ã‚Œã‚‹ã€** ç‚¹ã‹ã‚‰ç”»é¢ã«æç”»ã—ãªã„å€¤ã§ã‚ã‚Œã°éå¸¸ã«ã‚·ãƒ³ãƒ—ãƒ«ã«å–ã‚Šå›ã›ã¾ã™ã€‚

ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒã‚¦ãƒ³ãƒˆçŠ¶æ…‹ã€ç‰¹å®šã®å‡¦ç†ãŒä½•åº¦å‘¼ã³å‡ºã•ã‚ŒãŸã‹ã€é€ä¿¡å‰ã®ãƒ­ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã—ã¦ãŠããªã©æ§˜ã€…ãªä½¿ç”¨ç”¨é€”ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ã€‚

ä¾‹ãˆã°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå‘¼ã³å‡ºã—æ™‚ã«ã©ã†ã—ã¦ã‚‚ä¸€åº¦ã ã‘å‘¼ã³å‡ºã—ãŸã„å‡¦ç†ãŒã‚ã£ãŸã¨ã—ã¾ã™ã€‚
ä»¥ä¸‹ã®è¨˜äº‹ã§ã‚‚è§¦ã‚Œã‚‰ã‚Œã¦ã„ã¾ã™ãŒã€React v18 ã‹ã‚‰ã¯ StrictMode ä¸‹ã®é–‹ç™ºç’°å¢ƒã§ä¾å­˜é…åˆ—ãŒ `[]` ã ã£ãŸã¨ã—ã¦ã‚‚ useEffect ãŒè¤‡æ•°å›å‘¼ã³å‡ºã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
ï¼ˆç¾åœ¨ã§ã‚‚Fast Refreshç­‰ã§å†ç¾ã—ã¾ã™ï¼‰

[React 18 alphaç‰ˆç™ºè¡¨ã¾ã¨ã‚
](https://zenn.dev/uhyo/articles/react-18-alpha-essentials#strictmode-%E3%81%A7%E3%81%AE-useeffect-%E3%81%AE%E6%8C%99%E5%8B%95%E3%81%AE%E5%A4%89%E5%8C%96)

ã“ã‚Œã¯refã§ãƒ•ãƒ©ã‚°ã‚’ç®¡ç†ã™ã‚Œã°å…±é€šãƒ•ãƒƒã‚¯ã¨ã—ã¦ç°¡å˜ã«å®Ÿè£…ã§ãã¾ã™ã€‚

```ts:useEffectOnce.ts

const useEffectOnce = (effect: React.EffectCallback) => {
  const called = useRef(false);

  useEffect(() => {
    if (!called.current) {
      called.current = true;
      return effect();
    }
  }, []);
};
```

### usePrevious

usePreviousã¯[å…¬å¼ã§ã‚‚ç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹](https://ja.reactjs.org/docs/hooks-faq.html#how-to-get-the-previous-props-or-state)æœ‰åãªã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã§ã€å‰å›ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚ã®å€¤ã‚’ä¿å­˜ã—ã¦ä½¿ç”¨ã§ãã¾ã™ã€‚
ã¾ãŸã€ã“ã®å‰å›ã®å€¤ã¯å¤‰æ•°ã¨ã—ã¦ä¿æŒã•ã‚Œã‚‹ãŸã‚UIä¸Šã«æç”»ã—ã¦ã‚‚æ„å›³é€šã‚Šã«å‹•ä½œã—ã¾ã™ã€‚

```ts:usePrevious.ts
const usePrevious = <T extends unknown>(value: T) => {
  const ref = useRef<T>();
  useEffect(() => {
    ref.current = value;
  });
  return ref.current;
}
```

```tsx
const Counter = () => {
  const [count, setCount] = useState(0);
  const prevCount = usePrevious(count);
  
  return (
    ...
  );
};
```

ã“ã®usePreviousã®å®Ÿè£…ã‚’è¦‹ã¦ã€ŒRefã®å€¤ã¯å€¤ãŒåŒæœŸçš„ã«æ›´æ–°ã•ã‚Œã‚‹ã®ã§ã¯ï¼Ÿã“ã‚Œã§å‰å›ã®å€¤ã‚’è¿”ã›ã‚‹ã®ï¼Ÿã€ã¨ç–‘å•ã‚’æŒã¤æ–¹ã‚‚ã„ã‚‹ã‹ã‚‚çŸ¥ã‚Œã¾ã›ã‚“ã€‚
ã“ã‚Œã¯ return ã§ ref.current ã‚’è¿”å´ã—ã¦ãŠã‚Šã€ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å¾Œã® useEffect ãŒå®Ÿè¡Œã•ã‚Œã‚‹å‰ã®å€¤ã‚’è¿”å´ã—ã¦ã„ã‚‹ãŸã‚ã§ã™ã€‚
ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãæ›ãˆã‚‹ã¨ã‚ã‹ã‚Šã‚„ã™ã„ã§ã—ã‚‡ã†ã‹ã€‚

```ts:usePrevious.ts
const usePrevious = <T extends unknown>(value: T) => {
  const ref = useRef<T>();
  // ã‚‚ã¨ã‚‚ã¨ã®å®Ÿè£…ã§ return ã—ã¦ã„ãŸä»¥å‰ã®å€¤
  const prev = ref.current;
  useEffect(() => {
    ref.current = value;
  });
  
  return { ref, prev };
}
```

```tsx
const Counter = () => {
  const [count, setCount] = useState(0);
  const { ref, prev } = usePrevious(count);
  
  return (
    <button
      onClick={() => {
        console.log(ref, prev);
        setCount((prevCount) => prevCount + 1);
      }}
    >
      ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—
    </button>
};
```

å®Ÿè¡Œçµæœã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚
useEffectã§æ›´æ–°ã•ã‚Œã‚‹å‰ã«å¤‰æ•°ã«ä»£å…¥ã—ãŸ prev ã§ã¯å‰å›ã®å€¤ãŒå‚ç…§ã§ãã€refã«ã¯æœ€æ–°ã®å€¤ãŒå…¥ã£ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/aad5378c516d-20211130.png)


### refã«é–¢æ•°ã‚’ä¿å­˜ã™ã‚‹

ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã¨åº¦ã€… callback ã‚’å—ã‘å–ã‚‹ãƒ•ãƒƒã‚¯ã‚’ä½œã‚ŠãŸããªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
ä¾‹ãˆã° useApi ã®ã‚ˆã†ãªå¤–éƒ¨ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¡Œã†é–¢æ•°ã‚’å—ã‘å–ã‚Šã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’è¿”å´ã™ã‚‹ã‚ˆã†ãªã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã‚’ä½œã‚‹ã¨ã—ã¾ã™ã€‚

```ts:useApi.ts
type PromiseFunc = (...cb: any) => Promise<any>;
type PromiseReturnType<T extends PromiseFunc> = ReturnType<T> extends Promise<infer T> ? T : never;

const useApi = <T extends PromiseFunc>(callback: T) => {
  const [data, setData] = useState<PromiseReturnType<T>>();

  const request = useCallback(async () => {
    const data = await callback();
    setData(data);
  }, [callback]);

  useEffect(() => {
    request();
  }, [request]);

  return data;
}
```

å¼•æ•°ã« callback ã‚’å—ã‘å–ã‚Šã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’ useState ã§ä¿å­˜ã™ã‚‹ã ã‘ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã§ã™ã€‚
ã§ã™ãŒã€ã“ã®ã‚³ãƒ¼ãƒ‰ã¯**ç„¡é™ãƒ«ãƒ¼ãƒ—**ã‚’å¼•ãèµ·ã“ã™å±é™ºæ€§ã‚’å«ã‚“ã§ã„ã¾ã™ã€‚

```tsx:Page.tsx
// ãƒ€ãƒŸãƒ¼ã®APIãƒªã‚¯ã‚¨ã‚¹ãƒˆ
const apiRequest = (): Promise<number> => {
  return new Promise((resolve) =>
    setTimeout(() => resolve(Math.floor(Math.random() * 1000)), 3000)
  );
};

const Counter = () => {
  const data = useApi(() => apiRequest());
  console.log(data);

  return ...;
};
```

ä¾‹ãˆã° useApi ãƒ•ãƒƒã‚¯ã® callback ã«ãƒ¡ãƒ¢åŒ–ã•ã‚Œã¦ã„ãªã„é–¢æ•°ãŒæ¸¡ã•ã‚Œã‚‹ã¨éå¸¸ã«å±é™ºã§ã™ã€‚
ãƒªã‚¯ã‚¨ã‚¹ãƒˆçµ‚äº†å¾Œã« setData ã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¦ãƒ¡ãƒ¢åŒ–ã•ã‚Œã¦ã„ãªã„ callback ãŒå†ç”Ÿæˆã•ã‚Œã‚‹ã“ã¨ã«ã‚ˆã‚Šã€å†åº¦ request é–¢æ•°ãŒå®Ÿè¡Œã•ã‚Œã¦ç„¡é™ã«APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¦ã—ã¾ã†ã“ã¨ãŒæƒ³å®šã•ã‚Œã¾ã™ã€‚

ã“ã®ç„¡é™ãƒ«ãƒ¼ãƒ—ã‚’å®‰ç›´ã«è§£æ±ºã—ã‚ˆã†ã¨ã™ã‚‹ã¨ useEffect ã®ç¬¬2å¼•æ•°ã‚’ç©ºã«ã—ã¦ã—ã¾ã†æ–¹æ³•ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ã€‚`react-hooks/exhaustive-deps` ãƒ«ãƒ¼ãƒ«ã«æŒ‡æ‘˜ã¯ã•ã‚Œã¾ã™ãŒ `eslint-disable` ã§ç„¡åŠ¹ã«ã—ã¦ã—ã¾ãˆã°å®Ÿè£…ã¨ã—ã¦ã¯å•é¡Œãªã„ã§ã—ã‚‡ã†ã€‚
ã—ã‹ã—ä»Šå¾Œã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’å—ã‘å–ã‚‹ã‚ˆã†ãªæ©Ÿèƒ½è¿½åŠ ãŒã•ã‚ŒãŸã¨ãã«ä½•ã«ä¾å­˜ã—ã¦ã„ã‚‹ã‹ã‚’è€ƒãˆç›´ã™å¿…è¦ãŒã‚ã‚‹ãŸã‚ã€ä¾å­˜é…åˆ—ã«æ‰‹ã‚’å…¥ã‚Œã‚‹ã®ã¯ã§ãã‚Œã°æœ€çµ‚æ‰‹æ®µã«ã—ã¦ãŠããŸã„ã¨ã“ã‚ã§ã™ã€‚

```ts:useApi.ts
  useEffect(() => {
    request();
  }, []);
```

ã“ã†ã„ã£ãŸã¨ãã«ä¾¿åˆ©ãªã®ãŒ useRef ã«é–¢æ•°ã‚’ä¿å­˜ã™ã‚‹æ–¹æ³•ã§ã™ã€‚

```ts:useApi.ts
const useApi = <T extends PromiseFunc>(callback: T) => {
  const [data, setData] = useState<PromiseReturnType<T>>();
  const ref = useRef<T>();

  useEffect(() => {
    ref.current = callback;
  }, [callback]);

  const request = useCallback(async () => {
    const data = await ref.current?.();
    setData(data);
  }, []);

  useEffect(() => {
    request();
  }, [request]);

  return data;
}
```

callbackãŒæ›´æ–°ã•ã‚Œã‚‹æ¯ã« ref ã«ä¿æŒã—ã¦ã„ã‚‹é–¢æ•°ã‚’æ›´æ–°ã—ã¦ã€ref.currentã§é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚
refã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯åŒä¸€ã§ã‚ã‚‹äº‹ãŒä¿è¨¼ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€é–¢æ•°ã‚’ ref ã«å…¥ã‚Œã¦ãŠãã“ã¨ã§ä¾å­˜é…åˆ—ã‚’æ°—ã«ã›ãšå®Ÿè£…ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

## æœ€å¾Œã«

useRef ã¯ useState ã®ã‚ˆã†ã«çŠ¶æ…‹ç®¡ç†ã®ä¸»å½¹ã¨ã„ã†ã‚ã‘ã§ã¯ãªã„ã§ã™ãŒã€éå¸¸ã«å°å›ã‚Šã®åŠ¹ãä¾¿åˆ©ãªHooksã§ã™ã€‚
useState ã¨ã®é•ã„ã‚’æ„è­˜ã—ãŸä¸Šã§é©åˆ‡ã«ä½¿ç”¨ã™ã‚Œã°å®Ÿè£…ã®å¹…ãŒåºƒãŒã‚Šã¾ã™ã€‚

## å‚è€ƒ

- https://ja.reactjs.org/docs/hooks-reference.html
- https://overreacted.io/ja/a-complete-guide-to-useeffect/
- https://overreacted.io/react-as-a-ui-runtime/
